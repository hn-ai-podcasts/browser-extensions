#!/usr/bin/env sh

echo "ğŸ” Running pre-commit checks..."

STAGED_JS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^src/.*\.js$' || true)

if [ -n "$STAGED_JS" ]; then
  echo "\nğŸ§¹ Stripping comments..."
  echo "$STAGED_JS" | xargs bun run scripts/strip-comments.ts

  echo "\nğŸ” Formatting and linting with Biome..."
  echo "$STAGED_JS" | xargs bunx @biomejs/biome check --write --unsafe

  echo "$STAGED_JS" | xargs git add
fi

echo "\nğŸ” Running lint-staged..."
bunx lint-staged

echo "\nâœ… Pre-commit checks passed!"
